# ============================================
# Plugins
# ============================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'CrispyConductor/tmux-copy-toolkit'

# ============================================
# Plugin Settings
# ============================================
# tmux-copy-toolkit: https://github.com/CrispyConductor/tmux-copy-toolkit
set -g @copytk-copy-command "pbcopy"

# extrakto: https://github.com/laktak/extrakto
set-option -g @extrakto_editor "tmux popup -E -w 80% -h 80% nvim"
set-option -g @extrakto_popup_size "80%"

# catppuccin theme: https://github.com/catppuccin/tmux
set -g @catppuccin_status_background "none"

# ============================================
# General Settings
# ============================================
set -g mouse on
set -g renumber-windows on
set -g focus-events on
set -g default-terminal "xterm-256color"

# ============================================
# Key Bindings
# ============================================
# Change prefix from C-b to C-w
unbind C-b
set -g prefix C-w
bind C-w send-prefix

# Synchronize panes
bind S set-window-option synchronize-panes

# Split pane nvim for quick note
# Popup version (alternative):
# bind-key i popup -w 50% -h 40% -E "sh -c 'f=\$(mktemp); nvim \$f; cat \$f | pbcopy; rm -f \$f'"
bind-key i split-window -v -p 25 "sh -c 'f=\$(mktemp); nvim \$f; cat \$f | pbcopy; rm -f \$f'"

# Window navigation (prefix-free)
bind -n C-, previous-window
bind -n C-. next-window

# Copy mode (prefix-free)
bind -n C-v copy-mode \; send-keys -X start-of-line

# ============================================
# Copy Mode (Vi-style)
# ============================================
setw -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'C-v' send -X rectangle-toggle
bind-key -T copy-mode-vi 'y' send -X copy-selection
bind-key -T copy-mode-vi '0' send -X start-of-line

# ============================================
# Window & Status Bar
# ============================================
# Automatic window renaming
# Show current command name
set -g automatic-rename on
set -g automatic-rename-format '#{pane_current_command}'
set -g status-interval 1

# Status bar layout
set -g status-left " "
set -g status-right "#{E:@catppuccin_status_session}"
set -g @catppuccin_window_text " #W"
set -g @catppuccin_window_current_text " #W"

# ============================================
# Initialize TPM (keep this at the very bottom)
# ============================================
run '~/.config/tmux/plugins/tpm/tpm'

# ============================================
# Popup Style (after TPM to avoid being overwritten)
# ============================================
set -gu popup-style
set -g popup-border-lines heavy
